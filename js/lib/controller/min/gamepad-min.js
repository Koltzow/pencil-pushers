define(function(){var t={supported:"getGamepads"in navigator,controllers:[{connected:!1,ready:!1,player:null,character:0,buttons:[],sticks:[],stick:{},dir:{x:0,y:0}},{connected:!1,ready:!1,player:null,character:1,buttons:[],sticks:[],stick:{},dir:{x:0,y:0}},{connected:!1,ready:!1,player:null,character:2,buttons:[],sticks:[],stick:{},dir:{x:0,y:0}},{connected:!1,ready:!1,player:null,character:3,buttons:[],sticks:[],stick:{},dir:{x:0,y:0}}]};return t.update=function(){if(navigator.getGamepads().length>0)for(var t=0;t<navigator.getGamepads().length;t++)if(void 0!==navigator.getGamepads()[t]){this.controllers[t].connected||(console.log("GAMEPAD "+(t+1)+": Connected"),this.controllers[t].player=EXP.player.create()),this.controllers[t].connected=!0;for(var s=0;s<navigator.getGamepads()[t].buttons.length;s++)void 0!==this.controllers[t].buttons[s]?(!this.controllers[t].buttons[s].pressed&&navigator.getGamepads()[t].buttons[s].pressed?(this.controllers[t].buttons[s].click=!0,EXP.debug.gamepad&&console.log("C: "+(t+1)+" click: "+s)):this.controllers[t].buttons[s].click=!1,this.controllers[t].buttons[s].pressed=navigator.getGamepads()[t].buttons[s].pressed,this.controllers[t].buttons[s].value=navigator.getGamepads()[t].buttons[s].value):(this.controllers[t].buttons[s]={},this.controllers[t].buttons[s].pressed=navigator.getGamepads()[t].buttons[s].pressed,this.controllers[t].buttons[s].value=navigator.getGamepads()[t].buttons[s].value,this.controllers[t].buttons[s].click=!1);this.controllers[t].stick.left=!1,this.controllers[t].stick.right=!1,this.controllers[t].stick.down=!1,this.controllers[t].stick.up=!1;for(var e=0;e<navigator.getGamepads()[t].axes.length;e++)e<2&&(Math.round(this.controllers[t].sticks[e])||0===Math.round(navigator.getGamepads()[t].axes[e])||(0===e&&Math.round(navigator.getGamepads()[t].axes[e])===-1?(EXP.debug.gamepad&&console.log("C: "+(t+1)+" stick left"),this.controllers[t].stick.left=!0):0===e&&1===Math.round(navigator.getGamepads()[t].axes[e])?(EXP.debug.gamepad&&console.log("C: "+(t+1)+" stick right"),this.controllers[t].stick.right=!0):1===e&&Math.round(navigator.getGamepads()[t].axes[e])===-1?(EXP.debug.gamepad&&console.log("C: "+(t+1)+" stick up"),this.controllers[t].stick.up=!0):1===e&&1===Math.round(navigator.getGamepads()[t].axes[e])&&(EXP.debug.gamepad&&console.log("C: "+(t+1)+" stick down"),this.controllers[t].stick.down=!0))),this.controllers[t].sticks[e]=navigator.getGamepads()[t].axes[e];void 0!==this.controllers[t].buttons[0]&&(this.controllers[t].sticks=navigator.getGamepads()[t].axes),this.controllers[t].dir.x=0,this.controllers[t].sticks.length>0&&(this.controllers[t].dir.x=Math.round(3*this.controllers[t].sticks[0]),this.controllers[t].dir.y=Math.round(3*this.controllers[t].sticks[1])),this.controllers[t].buttons[9].pressed&&(EXP.engine.stopped||EXP.engine.stop())}else{if(this.controllers[t].connected){console.log("GAMEPAD "+(t+1)+": Disconnected"),EXP.engine.players--,this.controllers[t].player=null;for(var s=0;s<EXP.engine.bodies.length;s++)"player"===EXP.engine.bodies[s].type&&EXP.engine.bodies[s].id===t+1&&EXP.engine.bodies.splice(s,1)}this.controllers[t].connected=!1,this.controllers[t].buttons=[],this.controllers[t].sticks=[]}},t});