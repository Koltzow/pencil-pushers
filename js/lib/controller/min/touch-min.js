define(function(){var t={supported:"ontouchstart"in window,enabled:!1,radius:10,threshold:20,pos:{start:null,move:null},dir:{x:0,y:0},joystick:null,boost:null,listeners:[]};return t.start=function(t){t.preventDefault(),this.enabled||(this.enabled=!0),this.pos.start={x:t.touches[0].clientX,y:t.touches[0].clientY}},t.move=function(t){if(null!==this.pos.start){this.pos.move={x:t.touches[0].clientX,y:t.touches[0].clientY},this.dir.x=0,this.dir.y=0;var e=this.pos.move.x-this.pos.start.x,n=this.pos.move.y-this.pos.start.y;e<this.threshold&&e>-this.threshold&&n<this.threshold&&n>-this.threshold||(angle=Math.atan2(-1,0)-Math.atan2(n,e),angle=360*-angle/(2*Math.PI),angle=angle<0?angle+360:angle,angle<22.5||angle>=337.5?this.dir.y=-1:angle<67.5&&angle>=22.5?(this.dir.x=1,this.dir.y=-1):angle<112.5&&angle>=67.5?this.dir.x=1:angle<157.5&&angle>=112.5?(this.dir.x=1,this.dir.y=1):angle<202.5&&angle>=157.5?this.dir.y=1:angle<247.5&&angle>=202.5?(this.dir.x=-1,this.dir.y=1):angle<292.5&&angle>=247.5?this.dir.x=-1:angle<337.5&&angle>=292.5&&(this.dir.x=-1,this.dir.y=-1))}},t.end=function(t){null!==this.pos.start&&null===this.pos.move&&console.log("click"),this.pos.start=null,this.pos.move=null,this.dir={x:0,y:0}},t.render=function(){null!==this.pos.start&&(EXP.engine.ctx.beginPath(),EXP.engine.ctx.arc(this.pos.start.x,this.pos.start.y,40,0,2*Math.PI,!1),EXP.engine.ctx.lineWidth=2,EXP.engine.ctx.strokeStyle="white",EXP.engine.ctx.stroke()),null!==this.pos.move&&(EXP.engine.ctx.beginPath(),EXP.engine.ctx.arc(this.pos.move.x,this.pos.move.y,20,0,2*Math.PI,!1),EXP.engine.ctx.fillStyle="rgba(255,255,255,0.5)",EXP.engine.ctx.fill())},t.addClickListener=function(t,e,n){},window.addEventListener("touchstart",t.start.bind(t),!1),window.addEventListener("touchmove",t.move.bind(t),!1),window.addEventListener("touchend",t.end.bind(t),!1),t});