define(function(){var i={};return i.create=function(i){i=i||{};var t={};return t.controllable=i.controllable||!1,t.type="player",t.label="astronaut",t.x=i.x||0,t.y=i.y||0,t.z=i.z||0,t.vz=0,t.shield=100,t.maxShield=100,t.health=50,t.maxHealth=100,t.speed=7,t.diagonalSpeed=4,t.width=i.width||32,t.height=i.height||32,t.collider={width:18,height:7,left:7,top:25},t.dir={x:0,y:0},t.inventoryLimit=6,t.inventory=[],t.history=[],t.maxHistory=20,t.step=!1,t.walking=!1,t.jumping=!1,t.footsteps=new Image,t.footsteps.src="images/tilesheets/characters/footsteps.png",t.shadow=new Image,t.shadow.src="images/tilesheets/characters/shadow.png",t.tilesheet=new Image,t.tilesheet.src="images/tilesheets/characters/player.png",t.animations={idle:{right:{x:0,y:0,f:1,s:1},down:{x:1,y:0,f:1,s:1},left:{x:2,y:0,f:1,s:1},up:{x:3,y:0,f:1,s:1}},walking:{right:{x:0,y:1,f:4,s:2},downright:{x:0,y:2,f:4,s:2},down:{x:0,y:3,f:4,s:2},downleft:{x:0,y:4,f:4,s:2},left:{x:0,y:5,f:4,s:2},upleft:{x:0,y:6,f:4,s:2},up:{x:0,y:7,f:4,s:2},upright:{x:0,y:8,f:4,s:2}},flying:{right:{x:0,y:9,f:4,s:2}}},t.currentAnimation=t.animations.idle.down,t.currentAnimationFrame=0,EXP.ui.inventorybar.targetInventory=t.inventory,t.update=function(){if(this.controllable){var i=this.x,t=this.y,n=EXP.controller.dir,e=!1;0!==n.x||0!==n.y?(this.walking||0!==Math.round(this.z)||EXP.sound.play("footsteps",{loop:-1}),this.walking=!0,n.x>0&&0==n.y?this.currentAnimation=this.animations.walking.right:n.x>0&&n.y>0?(this.currentAnimation=this.animations.walking.downright,e=this.diagonalSpeed):0==n.x&&n.y>0?this.currentAnimation=this.animations.walking.down:n.x<0&&n.y>0?(this.currentAnimation=this.animations.walking.downleft,e=this.diagonalSpeed):n.x<0&&0==n.y?this.currentAnimation=this.animations.walking.left:n.x<0&&n.y<0?(this.currentAnimation=this.animations.walking.upleft,e=this.diagonalSpeed):0==n.x&&n.y<0?this.currentAnimation=this.animations.walking.up:n.x>0&&n.y<0&&(this.currentAnimation=this.animations.walking.upright,e=this.diagonalSpeed),this.dir.x=n.x,this.dir.y=n.y,this.x+=this.dir.x*(e||this.speed),this.y+=this.dir.y*(e||this.speed)):(EXP.sound.stop("footsteps"),this.walking=!1,this.dir.y>0?this.currentAnimation=this.animations.idle.down:this.dir.y<0?this.currentAnimation=this.animations.idle.up:this.dir.x>0?this.currentAnimation=this.animations.idle.right:this.currentAnimation=this.animations.idle.left)}(EXP.controller.keyboard.isPressed("Space")||EXP.controller.gamepad.connected&&EXP.controller.gamepad.buttons.length>0&&EXP.controller.gamepad.buttons[0].pressed)&&EXP.ui.jetfuelbar.target>0?(this.flying||(EXP.sound.play("jpstart",{volume:.5}),EXP.sound.play("jpboost",{loop:-1}),EXP.sound.stop("footsteps"),this.walking=!1),this.vz-=1.5,this.flying=!0,EXP.ui.jetfuelbar.target-=.005,EXP.effects.smoke.add(this.x,this.y-this.z+10)):(EXP.sound.stop("jpboost"),EXP.sound.stop("jpstart"),this.flying&&(EXP.sound.play("jpland",{volume:.5}),this.dir.y>0?this.currentAnimation=this.animations.idle.down:this.dir.y<0?this.currentAnimation=this.animations.idle.up:this.dir.x>0?this.currentAnimation=this.animations.idle.right:this.currentAnimation=this.animations.idle.left),this.flying=!1),this.vz+=1,this.z-=this.vz,this.z<0?(this.flying=!1,this.z=0,this.vz=0):this.z>100&&(this.z=100,this.vz=0),this.flying&&(this.walking=!1,this.currentAnimation=this.animations.flying.right),this.currentAnimationFrame+=1/this.currentAnimation.s,this.currentAnimationFrame>=this.currentAnimation.f&&(this.currentAnimationFrame=0);for(var s=!1,h=0;h<EXP.engine.bodies.length;h++)if(EXP.engine.bodies[h]!==this&&!EXP.engine.bodies[h].disabled)if(EXP.physics.collision.test(this,EXP.engine.bodies[h])&&this.z<EXP.engine.TILESIZE){if(void 0===EXP.engine.bodies[h].onCollisionEnter||EXP.engine.bodies[h].colliding||EXP.engine.bodies[h].onCollisionEnter(this),void 0!==EXP.engine.bodies[h].onCollisionStay&&EXP.engine.bodies[h].onCollisionStay(this),void 0!==EXP.engine.bodies[h].isTrigger&&EXP.engine.bodies[h].isTrigger)continue;s=!0}else void 0!==EXP.engine.bodies[h].onCollisionExit&&EXP.engine.bodies[h].colliding&&EXP.engine.bodies[h].onCollisionExit(this);s&&(this.x=i,this.y=t);var i=this.x,t=this.y;this.walking&&EXP.effects.dust.add(i,t+16),EXP.ui.healthbar.target=this.health/this.maxHealth,EXP.ui.shieldbar.target=this.shield/this.maxShield},t.render=function(){this.walking&&(this.step=!this.step),EXP.engine.ctx.drawImage(this.shadow,0,0,32,5,Math.round(this.x+EXP.engine.width/2-this.width/2-EXP.camera.x),Math.round(this.y+29+EXP.engine.height/2-this.height/2-EXP.camera.y),32,5),EXP.engine.ctx.drawImage(this.tilesheet,(this.currentAnimation.x+Math.floor(this.currentAnimationFrame))*this.width,this.currentAnimation.y*this.height,this.width,this.height,Math.round(this.x+EXP.engine.width/2-this.width/2-EXP.camera.x),Math.round(this.y-this.z+EXP.engine.height/2-this.height/2-EXP.camera.y),this.width,this.height),EXP.debug.colliders&&(EXP.engine.ctx.fillStyle="rgba(0,255,0,0.5)",EXP.engine.ctx.fillRect(Math.round(this.x+this.collider.left+EXP.engine.width/2-this.width/2-EXP.camera.x),Math.round(this.y+this.collider.top-this.z+EXP.engine.height/2-this.height/2-EXP.camera.y),this.collider.width,this.collider.height))},t},i});