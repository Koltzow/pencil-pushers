define(function(){var t={};return t.create=function(t,i){var e=this;i=i||{},this.seed=t||"1",document.body.style.backgroundColor="#111",this.container=document.createElement("div"),this.container.id="canvas-container",this.container.style.height=window.innerHeight+"px",this.container.style.width=window.innerWidth+"px",this.container.style.display="table";var n=document.createElement("div");n.id="cavnas-container-inner",n.style.display="table-cell",n.style.verticalAlign="middle",this.container.appendChild(n),document.body.appendChild(this.container),this.mainloop=null,this.TILESIZE=32,this.bodies=[],this.players=0,this.maxPlayers=2,this.stopped=!0,this.fullscreen=i.fullscreen||!0,this.width=640,this.height=360,this.backgroundColor=i.backgroundColor||"#03a9f4",this.fps=i.fps||60,this.camera=i.camera||{x:0,y:0},this.canvas=document.createElement("canvas"),this.canvas.style.margin="0 auto",this.canvas.width=this.width,this.canvas.height=this.height;var s,h;this.fullscreen?this.width/this.height<window.innerWidth/window.innerHeight?(s=this.width/this.height*window.innerHeight,h=window.innerHeight):(s=window.innerWidth,h=this.height/this.width*window.innerWidth):(s=this.width,h=this.height),this.canvas.style.width=s+"px",this.canvas.style.height=h+"px",n.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.ctx.imageSmoothingEnabled=!1,this.ctx.mozImageSmoothingEnabled=!1,this.ctx.oImageSmoothingEnabled=!1,this.ctx.webkitImageSmoothingEnabled=!1,this.ctx.msImageSmoothingEnabled=!1,window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(t){window.setTimeout(t,1e3/e.fps)}}(),this.now=Date.now(),this.then=Date.now(),this.interval=1e3/this.fps,this.delta=0,window.addEventListener("resize",this.resize.bind(this)),EXP.controller.keyboard.addKeyPressListener("Escape",function(){e.stopped?e.run():e.stop()})},t.clear=function(){this.ctx.clearRect(0,0,this.width,this.height)},t.update=function(){if(EXP.controller.update(),void 0!==EXP.startscreen&&EXP.startscreen.active)return void EXP.startscreen.update();this.bodies.sort(function(t,i){return t.y+t.collider.top+t.collider.height>i.y+i.collider.top+i.collider.height});for(var t=0;t<this.bodies.length;t++)this.bodies[t].update();EXP.ui.update(),EXP.effects.update(),void 0!==EXP.camera.target&&EXP.camera.update()},t.render=function(){if(this.clear(),void 0!==EXP.startscreen&&EXP.startscreen.active)return void EXP.startscreen.render();EXP.room.render();for(var t=0;t<this.bodies.length;t++)this.bodies[t].render();EXP.effects.render(),EXP.ui.render()},t.add=function(t){this.bodies.push(t)},t.resize=function(){var t,i;this.container.style.height=window.innerHeight+"px",this.container.style.width=window.innerWidth+"px",this.fullscreen?this.width/this.height<window.innerWidth/window.innerHeight?(t=this.width/this.height*window.innerHeight,i=window.innerHeight):(t=window.innerWidth,i=this.height/this.width*window.innerWidth):(t=this.width,i=this.height),this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",this.render()},t.loop=function(){this.mainloop=requestAnimFrame(this.loop.bind(this)),this.now=Date.now(),this.delta=this.now-this.then,this.delta>this.interval&&(this.then=this.now-this.delta%this.interval,this.stopped||this.update(),this.stopped||this.render())},t.run=function(){console.log("ENGINE: Run"),this.stopped&&(EXP.sound.playAll(),this.loop(),this.stopped=!1)},t.stop=function(){this.stopped||(console.log("ENGINE: Stop"),EXP.sound.play("menu"),setTimeout(function(){EXP.sound.pauseAll()},500),window.cancelAnimationFrame(this.mainloop),this.render(),this.ctx.fillStyle="rgba(0, 0, 0, 0.5)",this.ctx.fillRect(0,0,this.width,this.height),this.stopped=!0)},t});